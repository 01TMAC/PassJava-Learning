# 5000字 | 20张图带你玩转Java中的18种队列

封面图

本篇主要内容

## 一、队列自我介绍

![队列原理图](http://cdn.jayh.club/blog/20200905/2XdnOnK6ft3y.png?imageslim)

我叫队列，无论现实生活中还是计算机的世界中，我都是一个很重要的角色哦~

我是一种数据结构，大家可以把我想象成一个数组，元素从我的一头进入、从另外一头出去，称为FIFO原则（先进先出原则）。

我还有两个亲兄弟：List（列表）、Set（集），他们都是Collection的儿子，我还有一个远房亲戚：Map（映射）。他们都是java.util包这个大家庭的成员哦~

**现实生活中的场景：** 

- 海底捞排号等位（先排号的优先进餐厅）
- 邮政员寄送信件（信箱是队列）

**计算机世界中的场景：**

- 消息队列 RabbitMQ
- UDP协议（接收端将消息存放在队列中，从队列中读取数据）

## 二、18种队列的继承实现关系

**18种队列分为三大类：** 接口、抽象类、普通类。

弄清楚下面的继承实现关系对后面理解18个队列有很大帮助。

![18个Queue的继承实现关系图](http://cdn.jayh.club/blog/20200905/l4DUu2pvzH0o.png?imageslim)

- `Queue`接口**继承**`Collection`接口，`Collection`接口继承`Iterable`接口
- `BlockingQueue`接口、`Deque`接口、`AbstractQueue`抽象类**继承**`Queue`接口
- `BlockingDeque`接口、`TransferQueue`接口**继承**`BlockingQueue`接口
- `LinkedBlockingDeque`类**实现**`BlockingDeque`接口
- `LinkedTransferQueue`接口**实现**`TransferQueue`接口
- `LinkedList`类、`ArrayDeque`类、`ConcurrentLinkedDeque`类实现了Deque接口
- `ArrayBlockingQueue`类、`LinkendBlockingQueue`类、`LinkedBlockingDeque`类、`LinkedTransferQueue`类、`SynchronousQueue`类、`PriorityBlockQueue`类、`DelayQueue类`实现了`AbstractQueue`抽象类和BlockingQueue接口
- `PriorityQueue`类和`ConcurrentLinkedQueue`类实现了`AbstractQueue`抽象类

注意：Deque：全称Double-Ended queue，表示双端队列。

**帮你总结好的阻塞队列：** 

| 序号 | 名称                  | 类型   | 有界 | 线程安全 | 结构 | 特点                       | 使用场景 |
| ---- | --------------------- | ------ | ---- | -------- | ---- | -------------------------- | -------- |
| 1    | Queue<E>              | 接口   | /    | /        | /    | /                          |          |
| 2    | BlockingQueue<E>      | 接口   | /    | /        | /    | /                          |          |
| 3    | BlockingDeque<E>      | 接口   | /    | /        | /    | /                          |          |
| 4    | Deque<E>              | 接口   | /    | /        | /    | 双向                       |          |
| 5    | TransferQueue<E>      | 接口   | /    | /        | /    |                            |          |
| 6    | AbstractQueue         | 抽象类 | /    | /        | /    |                            |          |
| 7    | PriorityQueue         | 普通类 | N    | N        |      |                            |          |
| 8    | ArrayDeque            | 普通类 | N    | N        |      |                            |          |
| 9    | LinkedList            | 普通类 | N    | N        |      |                            |          |
| 10   | ConcurrentLinkedQueue | 普通类 | N    | Y        |      |                            |          |
| 11   | ConcurrentLinkedDeque | 普通类 | N    | Y        |      |                            |          |
| 12   | ArrayBlockingQueue    | 普通类 | Y    | Y        | 数组 | 默认不保证线程访问的公平性 |          |
| 13   | LinkedBlockingQueue   | 普通类 | Y    | Y        | 链表 |                            |          |
| 14   | LinkedBlockingDeque   | 普通类 | Y    | Y        | 链表 | 双向                       |          |
| 15   | LinkedTransferQueue   | 普通类 | N    | Y        | 链表 | 无界                       |          |
| 16   | SynchronousQueue      | 普通类 | Y    | Y        |      | 不存储元素                 |          |
| 17   | PriorityBlockQueue    | 普通类 | N    | Y        |      | 支持优先级排序、默认升序   |          |
| 18   | DelayQueue            | 普通类 | N    | Y        |      | 优先级排序、延时获取元素   |          |

## 二、Queue接口

- Queue接口是一种Collection，被设计用于处理之前临时保存在某处的元素。

- 除了基本的Collection操作之外，队列还提供了额外的插入、提取和检查操作。每一种操作都有两种形式：如果操作失败，则抛出一个异常；如果操作失败，则返回一个特殊值（null或false，取决于是什么操作）。

- 队列通常是以FIFO（先进先出）的方式排序元素，但是不是必须的。

- 只有优先级队列可以根据提供的比较器对元素进行排序或者是采用正常的排序。无论怎么排序，队列的头将通过调用remove()或poll()方法进行移除。在FIFO队列种，所有新的元素被插入到队尾。其他种类的队列可能使用不同的布局来存放元素。
- 每个Queue必须指定排序属性。

| 动作    | 抛异常    | 返回特殊值 |
| ------- | --------- | ---------- |
| Insert  | add(e)    | offer(e)   |
| Remove  | remove()  | poll       |
| Examine | element() | peek()     |



## ## 



**Java中的队列：** Queue接口，实现了Queue接口的类有 AbstractQueue、ArrayBlockingQueue、LinkendBlockingQueue、LinkedBlockingDeque、LinkedTransferQueue、SynchronousQueue、PriorityBlockQueue、DelayQueue、PriorityQueue、ConcurrentLinkedDeque、ConcurrentLinkedQueue、ArrayDeque、LinkedList。



# 怎么理解阻塞队列？

### 2.什么是阻塞队列

![阻塞队列](http://cdn.jayh.club/blog/20200905/gA1EP5f8AWR7.png?imageslim)

线程A往阻塞队列（Blocking Queue）中`添加`元素，而线程B从阻塞队列中`移除`元素。

- 当阻塞队列为空的时候（一个元素都没有），则从队列中获取元素的操作将会被阻塞。
  - 生活中的案例：去海底捞吃火锅的时候，早上8点没人来吃火锅，所以需要等客人过来。
  - 翻译成线程：现在没有元素需要添加，而且阻塞队列为空，所以线程B不需要从队列中拿元素出来，所以线程B获取元素的操作被阻塞了。
- 当阻塞队列满了的时候（所有位置都放有元素），则从队列中添加元素的操作将会被阻塞。
  - 生活中的案例：去海底捞吃火锅的时候，人太多了，需要排号，等其他桌空出来了才能进去。
  - 翻译成线程：线程A往阻塞队列中添加元素，将队列填满了，线程B现在正在忙，无法拿出队列中的元素，所以阻塞队列没有地方再放元素了，这个时候线程A添加元素的操作就被阻塞了

Java中的阻塞队列有7个：ArrayBlockingQueue、LinkedBlockingQueue、LinkedBlockingDeque、LinkedTransferQueue、SynchronousQueue、LinkedTransferQueue、DelayQueue。









- ArrayBlockingQueue  一个由数组结构构成的有界阻塞队列

- LinkedBlockingQueue 一个由链表结构构成的有界阻塞队列

​	

PriorityBlockingQueue 一个支持优先级排序的无界阻塞队列

DelayQueue 一个

