# Java并发必知必会第四弹：用积木讲解集合类

本篇主要内容如下



本篇所有代码已更新到Github: https://github.com/Jackson0714/PassJava-Learning

## 一、线程不安全之ArrayList

### 1、复习ArrayList

首先我们来复习下ArrayList的使用，下面是初始化一个ArrayList，数组存放的是Integer类型的值。

``` java
new ArrayList<Integer>();
```

那么底层做了什么操作呢？

源码：

```java
/**
 * Constructs an empty list with an initial capacity of ten.
 */
public ArrayList() {
    this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;
}
```

这段英文翻译过来就是：创建了一个空数组，容量为10

### 2、ArrayList单线程环境是否安全？

我们通过一个`添加积木的例子`来说明单线程下ArrayList是线程安全的。

![ArrayList单线程下添加元素](http://cdn.jayh.club/blog/20200826/Ezd0SaUYvx2E.png?imageslim)

（1）积木类还是沿用上两篇文章中用到的`BuildingBlock`

```java
/**
 * 积木类
 * @author: 悟空聊架构
 * @create: 2020-08-25
 */
class BuildingBlock {
    String shape;
    public BuildingBlock(String shape) {
        this.shape = shape;
    }
    @Override
    public String toString() {
        return "BuildingBlock{" + "shape='" + shape + '}';
    }
}
```

（2）初始化一个ArrayList

```java
ArrayList<BuildingBlock> arrayList = new ArrayList<>();
```

（3）依次添加三角形A、五角星B、五边形C、棱形D、三角形E、六边形F

```java
arrayList.add(new BuildingBlock("三角形"));
arrayList.add(new BuildingBlock("五角星"));
arrayList.add(new BuildingBlock("五边形"));
arrayList.add(new BuildingBlock("菱形"));
arrayList.add(new BuildingBlock("三角形"));
arrayList.add(new BuildingBlock("六角形"));
```

（4）验证`arrayList`中元素的内容和顺序是否和添加的一致

![打印ArrayList中元素](http://cdn.jayh.club/blog/20200826/aOazYqKaybhf.png?imageslim)

我们看到结果确实是一致的。

**小结：**单线程环境中，ArrayList是线程安全的。