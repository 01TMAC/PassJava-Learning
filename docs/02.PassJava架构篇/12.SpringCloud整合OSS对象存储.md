# 整合OSS对象存储

> 文件上传在系统中用的很频繁，所以我们需要将上传的文件进行存储，传统的将文件上传到本机已不适用分布式系统。自己搭建文件服务器有复杂性和维护成本。所以我们可以采用市面上成熟的文件存储服务，如阿里云的OSS对象存储服务。

## 1.开通阿里云OSS

- 登录阿里云官网

  https://www.aliyun.com/sale-season/2020/procurement-new-members?userCode=thp9caen

![登录阿里云官网](http://cdn.jayh.club/blog/20200427/0AJHQmBdGIpC.png?imageslim)



- 创建Bucket 存储桶

  ![创建Bucket 存储桶](http://cdn.jayh.club/blog/20200427/VPfBeJAPQ5Tb.png?imageslim)

- 获取accesskey id和secret

![获取accesskey id和secret](http://cdn.jayh.club/blog/20200427/hfgi86eqp8Ob.png?imageslim)

![获取accesskey id和secret](http://cdn.jayh.club/blog/20200427/pCrDo8UwFAWF.png?imageslim)

![获取accesskey id和secret](http://cdn.jayh.club/blog/20200427/xGPP7PFGK8uJ.png?imageslim)

- 分配权限

  分配 管理对象存储服务（OSS）权限

  ![分配权限](http://cdn.jayh.club/blog/20200427/2p085d9bNdaq.png?imageslim)

## 2.使用OSS SDK

### 1) 安装SDK

在Maven项目中加入依赖项

```xml
https://help.aliyun.com/document_detail/32009.html?spm=a2c4g.11186623.6.769.2c5145dc4TUgTa
<dependency>
    <groupId>com.aliyun.oss</groupId>
    <artifactId>aliyun-sdk-oss</artifactId>
    <version>3.8.0</version>
</dependency>
```

### 2) 上传文件到OSS

```java
@Test
    void testUploadByOss(){
        // Endpoint以杭州为例，其它Region请按实际情况填写。
        String endpoint = "http://oss-cn-beijing.aliyuncs.com";
        // 阿里云主账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM账号进行API访问或日常运维，请登录 https://ram.console.aliyun.com 创建RAM账号。
        String accessKeyId = "xxxx";
        String accessKeySecret = "xxxx";
        String bucketName = "passjava";

        // <yourObjectName>上传文件到OSS时需要指定包含文件后缀在内的完整路径，例如abc/efg/123.jpg。
        String objectName = "C:\\Users\\Administrator\\Pictures\\coding_java.png";

        // 创建OSSClient实例。
        OSS ossClient = new OSSClientBuilder().build(endpoint, accessKeyId, accessKeySecret);

        // 上传内容到指定的存储空间（bucketName）并保存为指定的文件名称（objectName）。
        String content = "Hello OSS";
        ossClient.putObject(bucketName, objectName, new ByteArrayInputStream(content.getBytes()));

        // 关闭OSSClient。
        ossClient.shutdown();
    }
```

![上传成功](http://cdn.jayh.club/blog/20200427/8jRWnK4nt7bE.png?imageslim)

## 3.整合Spring Cloud Alicloud OSS

### 1) passjava-common项目引入spring-cloud-starter-alicloud-oss依赖

```xml
<dependency>
    <groupId>com.alibaba.cloud</groupId>
    <artifactId>spring-cloud-starter-alicloud-oss</artifactId>
</dependency>
```

### 2) 配置alicloud oss

```yaml
spring:
  cloud:
    alicloud:
      access-key: xxxx
      secret-key: xxxx
      oss:
        endpoint: oss-cn-beijing.aliyuncs.com
```

### 3）测试上传

```
@Autowired
OSSClient ossClient;

@Test
void testUploadByAlicloudOss() {
    String bucketName = "passjava";
    String objectName = "C:\\Users\\Administrator\\Pictures\\jvm.jpg";
    String content = "Hello 123";
    ossClient.putObject(bucketName, objectName, new ByteArrayInputStream(content.getBytes()));
    ossClient.shutdown();
}
```

![上传成功](http://cdn.jayh.club/blog/20200427/rQgXycsRlFj7.png?imageslim)

## 4.获取服务端签名

