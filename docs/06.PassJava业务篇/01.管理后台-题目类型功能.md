PassJava (佳必过) 项目全套学习教程连载中，[关注公众号](#公众号)第一时间获取。

文档在线地址：www.jayh.club



# 添加和展示Java题目类型

## 1.环境准备

- 代码准备

  将renren-fast-vue代码copy到自己的前端项目中

- 安装node_module

```sh
cnpm install
```

- 启动前端portal

``` sh
npm run dev
```

- 登陆后台

  1.启动RenrenAplication
  
  2.输入用户名和密码登陆
  
  ![PassJava后台](http://cdn.jayh.club/blog/20200425/DQDm4seRS85s.png?imageslim)

## 2. 添加目录和菜单

- 添加`题目中心`目录(一级菜单)

![添加题目管理菜单](http://cdn.jayh.club/blog/20200425/xN7NHGsUFGNe.png?imageslim)

刷新页面,就可以看到题目中心菜单

- 添加题目`类型维护`菜单(二级菜单)

![题目类型维护菜单](http://cdn.jayh.club/blog/20200425/mg5QrTbMnNCn.png?imageslim)

![题目中心菜单](http://cdn.jayh.club/blog/20200425/NlVRP5AdpJjV.png?imageslim)

可以看到数据库新增了两条记录,分别对应两个菜单

![sys_menu表](http://cdn.jayh.club/blog/20200425/c6WJ6Xdt1JR9.png?imageslim)

点击类型维护菜单,打开了链接:http://localhost:8002/#/question-type,页面显示空白页面.

## 3.自动生成前端页面

用renren-generator自动生成前端代码,可以参考这篇:[13.SpringCloud实战项目-自动生成前后端代码](http://www.jayh.club/#/02.PassJava架构篇/04.自动生成前后端代码)

拷贝question目录到前端目录 \src\views\modules

![自动生成前端代码](http://cdn.jayh.club/blog/20200425/lQIv1UMSBLBH.png?imageslim)

![前端Vue页面](http://cdn.jayh.club/blog/20200425/pzjq0UwcnbfU.png?imageslim)



## 4. 测试类型维护功能

点击类型维护菜单,可以看到请求报404

 http://localhost:8080/renren-fast/question/type/list?t=1587825969456&page=1&limit=10&key=

![mark](http://cdn.jayh.club/blog/20200425/jdVLJmTeKUsh.png?imageslim)

> 因为页面的请求都访问到renren-fast服务了,所以要修改为访问题目微服务。但是前端有很多请求访问的是不同的服务，所以我们可以通过网关来作为请求的入口，然后将不同的请求路由到不同的服务。

SpringCloud整合网关可以看之前写的一篇文章：[20.SpringCloud整合Gateway网关](http://www.jayh.club/#/02.PassJava架构篇/11.SpringCloud整合Gateway网关)

## 6.配置请求到网关

文件：\static\config\index.js

api接口请求地址替换为gateway的地址

``` javascript
 window.SITE_CONFIG['baseUrl'] = 'http://localhost:8080/renren-fast';
 替换为
 window.SITE_CONFIG['baseUrl'] = 'http://localhost:8060'; // 网关地址
```

刷新页面，发现会回到登录页面，而且验证码获取不到，F12调试工具可以看到验证码请求发送到网关上，而网关上找不到这个请求地址(http://localhost:8060/captcha.jpg)，所以报404。其实验证码请求应该访问renren-fast服务，所以我们要将验证码请求通过网关转发到renren-fast服务(http://localhost:8080/renren-fast/captcha.jpg)。

``` json
# 验证码请求：
GET http://localhost:8060/captcha.jpg?uuid=1ce21f53-1866-40b1-8b20-2f4515d59f0d 404 (Not Found)
```

![获取验证码报404](http://cdn.jayh.club/blog/20200425/kAhPX4oiglXY.png?imageslim)

> 可以将renren-fast注册到注册中心，然后通过网关将请求转发到renren-fast服务。

## 6.注册renren-fast服务

- renren-fast项目添加common依赖

``` xml
<dependency>
    <groupId>com.jackson0714.passjava</groupId>
    <artifactId>passjava-common</artifactId>
    <version>0.0.1-SNAPSHOT</version>
</dependency>
```

- 配置注册中心地址

```yaml
cloud:
  nacos:
    discovery:
      server-addr: 127.0.0.1:8848
```

- 配置应用程序的名称

``` yaml
application:
  name: renren-fast
```

- 应用类添加`@EnableDiscoveryClient`注解

- 查看服务是否注册成功

![Nacos服务列表](http://cdn.jayh.club/blog/20200425/JcoXD3tdLLoQ.png?imageslim)

## 7. 添加网关路由规则

- 配置路由规则

passjava-gateway项目中application.yml文件配置路由规则，并重启passjava-gateway服务

```yaml
spring:
  cloud:
    gateway:
      routes:
        - id: route_portal # 路由规则id
          uri: lb://renren-fast # 负载均衡，renren-fast服务
          predicates: # 断言
            - Path=/api/** # 如果前端请求路径包含 api，则应用这条路由规则
          filters: #过滤器
            - RewritePath=/api/(?<segment>.*),/renren-fast/$\{segment} # 将跳转路径中包含的api替换成renren-fast
```

- 修改前端请求路径

文件：\static\config\index.js

请求路径添加`api`

``` javascript
 window.SITE_CONFIG['baseUrl'] = 'http://localhost:8086';
 替换为
 window.SITE_CONFIG['baseUrl'] = 'http://localhost:8060/api'; // 添加api
```

- 刷新登录页面，可以正常获取验证码，请求路径为网关地址 + /api/captcha
``` javascript
http://localhost:8060/api/captcha.jpg?uuid=84d36089-07ae-4201-85c0-8217b032f21b
```

- 登录，报跨域问题

  ``` javascript
Access to XMLHttpRequest at 'http://localhost:8060/api/sys/login' from origin 'http://localhost:8002' has been blocked by CORS policy: Response to preflight request doesn't pass access control check: No 'Access-Control-Allow-Origin' header is present on the requested resource.
  ```



## 代码地址

https://github.com/Jackson0714/PassJava-Platform

# 公众号

![公众号](http://cdn.jayh.club/blog/20200404/GU60Sv47XT7J.png?imageslim)