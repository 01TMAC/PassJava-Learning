# 一、Volatile是啥？

看到这个单词一直不知道怎么发音

```sh
英 [ˈvɒlətaɪl]  美 [ˈvɑːlətl]

adj. [化学] 挥发性的；不稳定的；爆炸性的；反复无常的
```

## 1.谈谈对Volatile 的理解？

- Volatile是Java虚拟机提供的`轻量级`的同步机制（三大特性）
  - 保证可见性
  - 不保证原子性
  - 禁止指令重排

要理解三大特性，就必须知道Java内存模型（JMM），那JMM又是什么呢？

# 二、JMM又是啥？

![Java内存模型](http://cdn.jayh.club/blog/20200812/154932124.png)

## 2.1 为什么需要Java内存模型？

> `Why`:屏蔽各种硬件和操作系统的内存访问差异

JMM是Java内存模型，也就是Java Memory Model，简称JMM，本身是一种抽象的概念，实际上并不存在，它描述的是一组规则或规范，通过这组规范定义了程序中各个变量（包括实例字段，静态字段和构成数组对象的元素）的访问方式。

## 2.2 到底什么是Java内存模型？

- 1.定义程序中各种变量的访问规则
- 2.把变量值存储到内存的底层细节
- 3.从内存中取出变量值的底层细节

## 2.3 Java内存模型的两大内存

- 主内存
  - Java堆中对象实例数据部分
  - 对应于物理硬件的内存
- 工作内存
  - Java栈中的部分区域
  - 优先存储于寄存器和高速缓存

## 2.4 Java内存模型是怎么做的？

Java内存模型的几个规范：

- 1.所有变量存储在主内存

- 2.主内存是虚拟机内存的一部分

- 3.每条线程有自己的工作内存

- 4.线程的工作内存保存变量的主内存副本

- 5.线程对变量的操作必须在工作内存中进行
- 6.不同线程之间无法直接访问对方工作内存中的变量
- 7.线程间变量值的传递均需要通过主内存来完成

由于JVM运行程序的实体是线程，而每个线程创建时JVM都会为其创建一个工作内存（有些地方称为栈空间），工作内存是每个线程的私有数据区域，而Java内存模型中规定所有变量都存储在主内存，主内存是共享内存区域，所有线程都可以访问，`但线程对变量的操作（读取赋值等）必须在工作内存中进行，首先要将变量从主内存拷贝到自己的工作内存空间，然后对变量进行操作，操作完成后再将变量写会主内存`，不能直接操作主内存中的变量，各个线程中的工作内存中存储着主内存中的变量副本拷贝，因此不同的线程间无法访问对方的工作内存，线程间的通信（传值）必须通过主内存来完成，其简要访问过程：

![Java内存模型](http://cdn.jayh.club/blog/20200812/141310523.png)

## 2.5 Java内存模型的三大特性

- 可见性（当一个线程修改了共享变量的值时，其他线程能够立即得知这个修改）
- 原子性（不可分割的操作）
- 有序性（变量赋值操作的顺序与程序代码中的执行顺序一致）

关于有序性：如果在本线程内观察，所有的操作都是有序的；如果在一个线程中观察另一个线程，所有的操作都是无序的。前半句是指“线程内似表现为串行的语义”（Within-Thread As-If-Serial Semantics），后半句是指“指令重排序”现象和“工作内存与主内存同步延迟”现象。



