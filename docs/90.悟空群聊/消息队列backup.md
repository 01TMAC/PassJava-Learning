# 如果把 4 个消息队列都拉到一个群里，他们会聊些什么？

本篇的灵感来自我超级喜欢的一篇文章：《如果把中国 442 位皇帝都放在一个群里面，他们会聊些什么》。

本篇也会以群聊或单聊的方式来讲解计算机世界中消息队列的一些奇闻趣事。

从事软件开发的同学，一定听过或用过消息队列，比如 RabbitMQ，Kafka。简单来说就是生产者将很多消息放到一个队列结构中，由其他消费者来消费。想了解更多队列知识，看下我之前写的 18 个 Queue 的文章，保证整的明明白白。传送门->

那如果把常见的 4 个消息队列拉到一个群里，会不会碰出一些火花呢？



## 被嫌弃

![mark](http://cdn.jayh.club/blog/20201016/133606817.png)

中间件大队长：各位队列同学，大家聚在一起不容易，今天敞开心扉聊聊天~

RabbitMQ-兔子：大家好啊，我是一只小兔子。

RocketMQ-火箭：这货怎么在里面？还卖起萌来了！

ActiveMQ-积极分子：他好像是用 Erlang 实现的，看不懂。

Kafka-日志采集：Erlang 是个啥？

RocketMQ：@中间件大队长，建议把 RabbitMQ 踢出去，看不懂他，而且名字起得跟我贼相似！



私聊

RabbitMQ-兔子：群主，为啥他们都嫌弃我呀，我也是非常棒的队列呀！

中间件大队长：Rabbit，你别担心，我已经习惯看他们天天没事瞎 BB 了。





涉及的故事：

- Erlang 是啥？
  - 并非一门新语言，出现于 1987 年。并不是面向对象语言。
  - 函数式编程，基于进程并发，高并发、分布式是它的优势。
  - 由爱立信制造商专门为通信应用设计，在国内主要是游戏领域用到。
- Erlang 为啥会被其他队列嫌弃？
  - 因为 RocketMQ、ActiveMQ 都是用 Java 实现的，Kafka 是用 Scale 和 Java 实现的，这三种消息队列从语言实现上都有些类似。
  - 在国内现如今超流行的 Java 的技术生态中，懂 Java 又懂 Erlang 的就比较少了，愿意花时间和精力在 Erlang 上面的就更少了。



## 快和慢

中间件大队长：大家肃静，都是一家人，好歹 Rabbit 也是 时效性最高的呀，微秒级，低延迟。看看你们几个，跟别人差一个数量级。

RabbitMQ：害羞表情。

ActiveMQ：兔子大佬，速度真快。

Kafka：不明觉厉！

RocketMQ：呵呵呵，光快有什么用？吞吐量有我厉害吗？

RabbitMQ：你是有多大的吞吐量？

ActiveMQ：@RabbitMQ，他和 Kafka 可以支持到 10 万级，看看我们俩只能到万级。



涉及的故事：

- 他们讨论的低延迟是啥？
  - 就是说这个消息队列的响应速度是非常快的，比如插入一条消息，可以很快的返回插入结果。可以理解为反射弧比较短。而RabbitMQ 的低延迟达到微秒级，而另外三个队列都是毫秒级。
- 他们讨论的吞吐量是啥？
  - 吞吐量：系统在单位时间内处理请求的数量。
  - RocketMQ 自称火箭，肯定是有他的道理的，因为他的处理请求的速度快呀！吞吐量可以达到 10 万级，而另外三个队列都是万级。



## 无界面

RabbitMQ：呵呵哒，不跟无操作界面的队列说话。

中间件大队长：不要人身攻击，RocketMQ 好歹也是大厂阿里出品，你们不能给他个面子？

Kafka：阿里大佬你好，交个朋友吗？

ActiveMQ：+ 1



他们聊的操作界面又是啥？

- RabbitMQ、ActiveMQ、Kafka 都是有界面来操作队列或消息的，而 RocketMQ 就比较坑了， 只提供了命令行工具，这对于长期使用 windows 的用户确实很难受呀。

## 社区别凉

RabbitMQ：阿里？那是以前好吗？现在 RocketMQ 捐给 Apache 后貌似就没有以前的活跃度了吧，鄙视的眼神。

RabbitMQ：我可是有活跃社区的哦！



- 他们说的阿里出品又是啥？
  - RocketMQ 由大厂阿里出品，已捐给 Apache 开源社区，活跃度不算高，会不会没人修 bug 了？
  - RabbitMQ 有活跃的开源社区，总能找到修 bug 的，你愿意用哪个？大厂推荐用 RocketMQ，可以自己折腾，小一点的还是用 RabbitMQ 吧，节省解决问题的成本。





##  mysql 的朋友圈

mysql 加入群聊

中间件大队长：你们团结一点，好吗？

中间件大队长：你们都看了 `mysql` 的朋友圈了吧，他还夸了你们的捏！

![mysql 的朋友圈](http://cdn.jayh.club/blog/20201016/104125856.png)

中间件大队长：我把数据库 mysql 老铁加进来了，他说很感谢你们做的事情，减轻了很多数据库的负担。

mysql 不会飞：大佬们，都在呢 ~ 谢谢你们的削峰，帮我抗住了双十一的压力！

RabbitMQ：不发个红包的吗？



涉及的故事：

消息队列常用在解耦、削峰、异步场景中。先对这几个点来个大白话扫盲：

- 悟空大白话削峰：关键词：**别都丢给我！**  比如双十一期间超多用户下单，假如 10万个请求都到数据库了，数据库一下子是扛不住这么多请求的，那么消息队列来解围，把请求丢到消息队列，订单服务从消息队列拿消息处理订单请求，起到了一个缓冲的作用，这样对数据库的压力就小多了。

- 悟空大白话解耦：关键词：**谁用谁拿** 。A 系统需要将数据传给 B、C、D、E 系统，A 系统时刻需要考虑 B、C、D、E 四个系统如果宕机了怎么办？要不要重发，要不要消息持久化存起来？A 系统要考虑的问题太多了，可把 A 系统累坏了。这就是一种高耦合的现象，BCDE 四个系统强依赖 A 系统。那怎么解耦？A 系统将数据丢到消息队列，BCDE 系统自己想要数据的时候就去消息队列里面拿。
- 悟空大白话异步：关键词：**先去忙你的吧~**  。比如下一笔订单，从订单支付到订单成功，这个闭环可能很长，比如要发送订单成功消息、赠送优惠券等等操作，用户等待的时间可能很久，用户体验就不好了，那怎么解决呢？可以将下单成功的消息丢到队列里面，快速返回订单成功，然后告知用户，后系消息触达系统再从队列里面拿到订单数据，依次给用户发送订单消息和优惠券就行了，这个就是异步。



中间件大队长：我看到网上有程序员喷你们坑太多，你们听说过没？

Kafka：纳尼？谁敢喷我们？

中间件大队长：叫悟空的那个家伙，他说三年被消息队列坑惨了，还细数了六大坑，我把他写的文章发给你们看看。

中间件大队长：非幂等、消息丢失、消息乱序、过期失效、消息积压、队列写满。

Kafka：......
RabbitMQ：......

ActiveMQ-积极分子：......

RocketMQ-火箭：......

四大消息队列都去看这篇文章去了，听说这篇文章被各大号主转载了 19 次。







想了解更多消息队列的聊天内容，加我微信备注加群。