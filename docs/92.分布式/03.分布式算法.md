# 用三国杀讲分布式算法，舒适了吧？

## 前言

> 《三国杀》是一款热门的卡牌游戏，结合中国三国时期背景，以身份为线索，以卡牌为形式，益智休闲，老少皆宜。

在讲解之前，我们先讲下分布式协议和算法（后续简称算法）是个啥。

现在很多开发同学对分布式的组件怎么使用都有一定经验，也知道 `CAP` 理论和 `BASE` 理论的大致含义。但认真去看分布式算法的真的很少，原因有三：

- 担心算法过于复杂，所以花的时间很少。
- 网上的资料能用大白话将分布式算法讲清楚的比较少。
- 学习分布式算法没有一条清晰的路线。

我会在后续的文章中用故事、大白话的方式来讲解分布式算法的原理，以及学习路线到底是怎么样的？

## 学习路线

学习分布式协议和算法的路线可以是先学习四大基础理论，作为地基，再学习分布式协议和算法，就像是在地基上建房子。地基打好了，才能建更稳固的高楼大厦。

### 四大基础理论

- 拜占庭将军问题
- CAP 理论
- ACID 理论
- BASE 理论

### 八大分布式协议和算法

- Paxos 算法
- Raft 算法
- 一致性 Hash 算法
- Gossip 协议算法
- Quorum NWR 算法
- FBFT 算法
- POW 算法
- ZAB 协议

因篇幅原因，本篇只涉及拜占庭将军问题。

## 拜占庭将军问题

大家可能听过拜占庭将军问题。它是由莱斯利·兰伯特提出的点对点通信中的基本问题，

`拜占庭`位于如今的土耳其的`伊斯坦布尔`，是`东罗马帝国`的首都。由于当时拜占庭罗马帝国国土辽阔，为了达到防御目的，每个军队都分隔很远，将军与将军之间只能靠信差传消息。在战争的时候，拜占庭军队内所有将军和副官必须达成一致的共识，决定是否有赢的机会才去攻打敌人的阵营。但是，在军队内有可能存有叛徒和敌军的间谍，这个就是拜占庭容错问题。

实际上拜占庭问题是分布式领域最复杂的一个容错模型，一旦理解它，就能掌握分布式共识问题的解决思路，还能帮助大家理解常用的共识算法，也可以帮助我们在工作中选择合适的算法，或者设计合适的算法。

为什么第一个基础理论是拜占庭将军问题？因为它很好地抽象出了分布式系统面临的共识问题。

下面我会用三国杀游戏中的身份牌来讲解拜占庭将军问题。

## 三国杀身份牌

三国杀中主要有四种身份：主公、忠臣、反贼、内奸。每个游戏玩家都会获得一个身份牌。主公只有 1 个。忠臣 最多 2 个，反贼最多 4个，内奸最多一个。

### 主公

![mark](http://cdn.jayh.club/blog/20201206/yJfMJQRnoTsi.png?imageslim)

**获胜条件：**消灭所有反贼和内奸

**技巧：**以自己生存为首要目标，分散反贼注意力。配合忠内剿灭反贼并判断谁是忠谁是内。

### 忠臣

![mark](http://cdn.jayh.club/blog/20201206/rccYI7wKjtFe.png?imageslim)

**获胜条件：**保护主公存活的前提下消灭所有反贼和内奸。

**技巧：**忠臣是主公的屏障，威慑反贼和内奸的天平。

### 反贼

![img](http://www.sanguosha.com/uploads/201808/5b7295bc08b23.jpg)

**获胜条件：**消灭主公即可获胜。

**技巧：**反贼作为数量最多的身份，需要集中火力猛攻敌人弱点。正确的思路是获胜的关键。

### 内奸

![mark](http://cdn.jayh.club/blog/20201206/ts5A08ToUj2U.png?imageslim)

**获胜条件：**先消灭反贼和忠臣，最后与主公单挑成为最后唯一生还者。

**技巧：**正确的战术+ 冷静的头脑+ 运气。